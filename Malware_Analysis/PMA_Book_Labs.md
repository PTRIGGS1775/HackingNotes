# Chapter 1
## Lab 1-1
This lab uses the files Lab01-01.exe and Lab01-01.dll. Use the tools and techniques described in the chapter to gain information about the files and answer the questions below.

Questions

1. Upload the files to http://www.VirusTotal.com/ and view the reports. Does either file match any existing antivirus signatures?
```markdown
# hash: bb7425b82141a1c0f7d60e5106676bb1
Yes, trojan malware.
```

2. When were these files compiled?
```markdown
# Use PEView. Select IMAGE_FILE_HEADER from under IMAGE_NT_HEADERS.
2010/12/19
```

3. Are there any indications that either of these files is packed or obfuscated? If so, what are these indicators?
```markdown
# Use PEiD and dependency walker
No signs of packing or obfuscation for either. As both import a lot of functions.
```

4. Do any imports hint at what this malware does? If so, which imports are they?
```md
# Used dependencies (x64)
Based on MapViewOfFile and the FindNextFile programs it apears that it is copying files. The DLL appears to be connecting to the internet to exfil those files perhaps?
```

5. Are there any other files or host-based indicators that you could look for on infected systems?
```md
If there is I'm not good enough to tell
- Update: I was wrong. kernel was spelled wrong and is an indicator of malicious activity.
```

6. What network-based indicators could be used to find this malware on infected machines?
```md
# Run strings on both DLL and EXE
There is an IP address in the DLL: 127.26.152.13
```

7. What would you guess is the purpose of these files?
```md
my guess is to exfil files.
```

## Lab 1-2
Analyze the file Lab01-02.exe.

Questions

1. Upload the Lab01-02.exe file to http://www.VirusTotal.com/. Does it match any existing antivirus definitions?
```md
# Command> certutil -hashfile "C:\Users\Trev\Desktop\Practical Malware Analysis Labs\BinaryCollection\Chapter_1L\Lab01-02.exe" md5
# Hash: 8363436878404da0ae3e46991e355b83
Shows up as a trojan of the course file.
```

2. Are there any indications that this file is packed or obfuscated? If so, what are these indicators? If the file is packed, unpack it if possible.
```md
# Using PEView
There is a UPX0/1/2 after the image_section_headers which indicates packing.
# Using DependenciesGUI
Few imports indicates packed process.
# Using PEID
I get the following response "UPX -> www.upx.sourceforge.net *"

# To UNPACK: upx -o unpacked-lab01-02.exe -d Lab01-02.exe
```

3. Do any imports hint at this program’s functionality? If so, which imports are they and what do they tell you?
```md
# Using floss and dependenciesGUI
After unpacking, we look at the imports sections and the strings. The imports from kernel32.dll and msvcrt.dll are imported by nearly every program, so they tell us little about this specific program. The imports from wininet.dll tell us that this code connects to the Internet (InternetOpen and InternetOpenURL), and the import from advapi32.dll (CreateService) tell us that the code creates a service. When we look at the strings, we see www.malwareanalysisbook.com, which is probably the URL opened by InternetOpenURL as well as by Malservice, which could be the name of the service that is created.
```

4. What host- or network-based indicators could be used to identify this malware on infected machines?
```md
# Ran the floss command to look at the string better than strings.
Looks like its pointing to a http://www.malwareanalysisbook.com and also there is something called malservice.
```

## Lab 1-3
Analyze the file Lab01-03.exe.

Questions

1. Upload the Lab01-03.exe file to http://www.VirusTotal.com/. Does it match any existing antivirus definitions?
```md
# Able to use md5sum {filename} on the Cmder app
# Hash: 9c5c27494c28ed0b14853b346b113145
Shows up as a trojan of the course file.
```

2. Are there any indications that this file is packed or obfuscated? If so, what are these indicators? If the file is packed, unpack it if possible.
```md
# Using PEView
first is that the file sections have no names. Next, we see that the first section has a virtual size of 0x3000, but a raw data size of 0.
# Using DependenciesGUI
Few imports indicates packed process.
# Using PEID
I get the following response "FSG 1.0 -> dulek/xt"; which means I believe the file has been packed.

# CAN'T UNPACK FSG YET
```

3. Do any imports hint at this program’s functionality? If so, which imports are they and what do they tell you?
```md
dunno can't unpack fsg yet.
```

4. What host- or network-based indicators could be used to identify this malware on infected machines?
```md
dunno can't unpack fsg yet.
```

## Lab 1-4
Analyze the file Lab01-04.exe.

Questions

1. Upload the Lab01-04.exe file to http://www.VirusTotal.com/. Does it match any existing antivirus definitions?
```md
just the course
```

2. Are there any indications that this file is packed or obfuscated? If so, what are these indicators? If the file is packed, unpack it if possible.
```md
Looks clean with both PEView and PEID
```

3. When was this program compiled?
```md
2019/08/30 which seems wrong since I know this is an older book.
```

4. Do any imports hint at this program’s functionality? If so, which imports are they and what do they tell you?
```md
# Using dependenciesGUI
Looks like advapi32 is trying to lookup and modify permissions. *LookupPrivilegeValue* and *AdjustTokenPriveleges*
```

5. What host- or network-based indicators could be used to identify this malware on infected machines?
```md
Looks like its creating an executable called wupdmgrd.exe to look like an update software then targetting http://www.practicalmalwareanalysis.com/updater.exe
```

6. This file has one resource in the resource section. Use Resource Hacker to examine that resource, and then use it to extract the resource. What can you learn from the resource?
```md
You need to export the resource from resource hacker and use standard static tools to review.
```

# Chapter 3
## Lab 3-1
Analyze the malware found in the file Lab03-01.exe using basic dynamic analysis tools.

Questions
1. What are this malware’s imports and strings?
```md

```

2. What are the malware’s host-based indicators?
```md

```

3. Are there any useful network-based signatures for this malware? If so, what are they?
```md

```

## Lab 3-2
Analyze the malware found in the file Lab03-02.dll using basic dynamic analysis tools.

Questions
1. How can you get this malware to install itself?
```md
To install the malware as a service, run the malware’s exported installA function via rundll32.exe with rundll32.exe Lab03-02.dll,installA.
```

2. How would you get this malware to run after installation?
```md
To run the malware, start the service it installs using the net command net start IPRIP.
```

3. How can you find the process under which this malware is running?
```md
Use Process Explorer to determine which process is running the service. Since the malware will be running within one of the svchost.exe files on the system, hover over each one until you see the service name, or search for Lab03-02.dll using the Find DLL feature of Process Explorer.
```

4. Which filters could you set in order to use procmon to glean information?
```md
In procmon you can filter on the PID you found using Process Explorer.
```

5. What are the malware’s host-based indicators?
```md
By default, the malware installs as the service IPRIP with a display name of Intranet Network Awareness (INA+) and description of “Depends INA+, Collects and stores network configuration and location information, and notifies applications when this information changes.” It installs itself for persistence in the registry at HKLM\SYSTEM\CurrentControlSet\Services\IPRIP\Parameters\ServiceDll: %CurrentDirectory%\Lab03-02.dll. If you rename Lab03-02.dll to something else, such as malware.dll, then it writes malware.dll into the registry key, instead of using the name Lab03-02.dll.
```

6. Are there any useful network-based signatures for this malware?
```md
The malware resolves the domain name practicalmalwareanalysis.com and connects to that host over port 80 using what appears to be HTTP. It does a GET request for serve.html and uses the User-Agent %ComputerName% Windows XP 6.11.
```

## Lab 3-3
Execute the malware found in the file Lab03-03.exe while monitoring it using basic dynamic analysis tools in a safe environment.

Questions
1. What do you notice when monitoring this malware with Process Explorer?
```md

```

2. Can you identify any live memory modifications?
```md

```

3. What are the malware’s host-based indicators?
```md

```

4. What is the purpose of this program?
```md

```

## Lab 3-4
Analyze the malware found in the file Lab03-04.exe using basic dynamic analysis tools. (This program is analyzed further in the Chapter 9 labs.)

Questions
1. What happens when you run this file?
```md

```

2. What is causing the roadblock in dynamic analysis?
```md

```

3. Are there other ways to run this program?
```md

```

## Lab 5-1

1. What is the address of DllMain?
`1000D02E initialized in blue under subroutine`

2. Use the Imports window to browse to gethostbyname. Where is the import located?
`100163CC`

3. How many functions call gethostbyname?
`Hit ctrl+x you'll see 18 functions call it but you'll notice they're all duplicates so it's 9`

4. Focusing on the call to gethostbyname located at 0x10001757, can you figure out which DNS request will be made?
`looks like practical malware analysis but I don't know why`

5. How many local variables has IDA Pro recognized for the subroutine at 0x10001656?
`ctrl+g and count the variables in the subroutine`
Q:

6. How many parameters has IDA Pro recognized for the subroutine at 0x10001656?

Q:

7. Use the Strings window to locate the string \cmd.exe /c in the disassembly. Where is it located?
`View ▸ Open Subviews ▸ Strings. In this list, double-click \cmd.exe /c to see it in the disassembly`
Q:

8. What is happening in the area of code that references \cmd.exe /c?

Q:

9. In the same area, at 0x100101C8, it looks like dword_1008E5C4 is a global variable that helps decide which path to take. How does the malware set dword_1008E5C4? (Hint: Use dword_1008E5C4’s cross-references.)

Q:

10. A few hundred lines into the subroutine at 0x1000FF58, a series of comparisons use memcmp to compare strings. What happens if the string comparison to robotwork is successful (when memcmp returns 0)?

Q:

11. What does the export PSLIST do?

Q:

12. Use the graph mode to graph the cross-references from sub_10004E79. Which API functions could be called by entering this function? Based on the API functions alone, what could you rename this function?

Q:

13. How many Windows API functions does DllMain call directly? How many at a depth of 2?

Q:

14. At 0x10001358, there is a call to Sleep (an API function that takes one parameter containing the number of milliseconds to sleep). Looking backward through the code, how long will the program sleep if this code executes?

Q:

15. At 0x10001701 is a call to socket. What are the three parameters?

Q:

16. Using the MSDN page for socket and the named symbolic constants functionality in IDA Pro, can you make the parameters more meaningful? What are the parameters after you apply changes?

Q:

17. Search for usage of the in instruction (opcode 0xED). This instruction is used with a magic string VMXh to perform VMware detection. Is that in use in this malware? Using the cross-references to the function that executes the in instruction, is there further evidence of VMware detection?
`search for the in instruction by selecting Search ▸ Text and entering in (we could also select Search ▸ Sequence of Bytes and searching for ED, the opcode for the in instruction)`
Q:

18. Jump your cursor to 0x1001D988. What do you find?

Q:

19. If you have the IDA Python plug-in installed (included with the commercial version of IDA Pro), run Lab05-01.py, an IDA Pro Python script provided with the malware for this book. (Make sure the cursor is at 0x1001D988.) What happens after you run the script?

Q:

20. With the cursor in the same location, how do you turn this data into a single ASCII string?

Q:

21. Open the script with a text editor. How does it work?

